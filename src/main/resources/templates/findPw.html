<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="stylesheet" href="../../resources/static/CSS/font.css">
	<style>
		@font-face {
			font-family: 'Tenada';
			src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2210-2@1.0/Tenada.woff2') format('woff2');
			font-weight: normal;
			font-style: normal;
		}
		@font-face {
			font-family: 'Pretendard-Regular';
			src: url('https://fastly.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Regular.woff') format('woff');
			font-weight: 400;
			font-style: normal;
		}
		header{
			font-family:'Tenada', 'sans-serif';
			margin-top: 300px;

			text-align: center;
		}
		body {
			font-family:'Pretendard-Regular', 'sans-serif';
			width: 1920px;
			font-size: 30px;
		}
		#user_id, label, button {
			width: 500px;
		}
		input:focus::placeholder {
			color: transparent;
		}
		li {
			display: inline-block;
			font-size: 25px;
			color: rgb(138, 137, 137);
		}
		#reg_first, #reg_last {
			width: 200px;
		}
		#user_email {
			width: 350px;
			margin-right: 50px;
		}
		#email_code {
			width: 350px;
			margin-right: 50px;
		}
		#timer {
			position: absolute;

			width: 100px;
		}
		#send_code, #confirm_code {
			width: 100px;
		}
		span {
			width: 100px;
			font-size: 40px;
		}
	</style>
</head>
<body>
<div class="container mx-auto">
	<header>
		<a href="home"><span class="mx-auto text-blue-500 font-bold" style="font-size: 90px;">ASKLEPIOS</span></a>
	</header>
	<div for="info" class="mx-px flex justify-center font-medium text-4xl font-bold text-black-500 dark:text-white">íšŒì› ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>
	<form action="findPw" method="post" onsubmit="return validateForm()">
		<div class="block justify-center mb-10">
			<div>
				<label for="user_id" class="mx-auto block mt-10 font-medium text-gray-900 dark:text-white">ì•„ì´ë””</label>
				<div class="mx-auto flex justify-center items-center">
          <input type="text" id="user_id" name="user_id"
          class="mx-auto block mt-5 bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3 focus:ring-2 focus:outline-none"
          placeholder="ì•„ì´ë””">
          </input>
				</div>
			</div>
      <div>
        <label for="user_email" class="mx-auto block mt-5 font-medium text-gray-900 dark:text-white">ì´ë©”ì¼</label>
        <div class="mx-auto flex justify-center items-center">
          <input type="text" id="user_email" name="user_email"
          class="mx-px block mt-5 bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3 focus:ring-2 focus:outline-none"
          placeholder="example@example.com">
          </input>
					<input type="button" id="send_code"  onclick ="send()"
								class="mt-5 py-3 font-semibold rounded-lg shadow-md text-white bg-blue-500 hover:bg-blue-700"
								value="ì „ì†¡">
				</div>
				<div>
					<label id="sendMsg" class="mx-auto block mt-3" style="color: red; font-size: 22px;">&nbsp;</label>
				</div>
      </div>
			<div>
				<label for="email_code" class="mx-auto block font-medium text-gray-900 dark:text-white">ì¸ì¦ë²ˆí˜¸</label>
				<div class="mx-auto flex justify-center items-center">
					<input type="text" id="email_code" name="email_code"
								class="mx-px mt-5 block bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3 focus:ring-2 focus:outline-none"
					placeholder="ì¸ì¦ì½”ë“œ 6ìë¦¬">
					<label for="confirm_code" id="timer" class="mx-px mt-5 ms-24 font-semibold" style="color:#3B82F6; font-size:25px"></label>
					<input type="button" id="confirm_code" onclick="check()"
								class="mt-5 py-3 font-semibold rounded-lg shadow-md text-white bg-blue-500 hover:bg-blue-700" value="í™•ì¸">
				</div>
			</div>
			<label id="errorMsg" class="mx-auto block py-3" style="color: red; font-size: 22px;">&nbsp;</label>
			<button type="submit" class="mx-auto block py-5 font-semibold rounded-lg shadow-md text-white bg-blue-500 hover:bg-blue-700">
				ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ë°œê¸‰
			</button>
      <!-- ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°ë¥¼ ëˆ„ë¥´ë©´ ë©”ì¼ë¡œ ì„ì‹œë²ˆí˜¸ë¥¼  -->
		</div>
	</form>
</div>
</body>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script>
	let send_email_code = "";
	function send(){
		let user_id = document.getElementById('user_id').value;
		let user_email = document.getElementById('user_email').value;
		let cnt = 0;
		if(user_id === ""){
			document.getElementById('sendMsg').innerText = "ğŸš« ëª¨ë“  ì…ë ¥ê°’ì€ í•„ìˆ˜ ì…ë‹ˆë‹¤.(ì•„ì´ë”” ë¯¸ê¸°ì…)";
			document.getElementById('user_id').focus();
			document.getElementById('sendMsg').style.color = "red";
		}
		else if(user_email === ""){
			document.getElementById('sendMsg').innerText = "ğŸš« ëª¨ë“  ì…ë ¥ê°’ì€ í•„ìˆ˜ ì…ë‹ˆë‹¤.(ì´ë©”ì¼ ë¯¸ê¸°ì…)";
			document.getElementById('user_email').focus();
			document.getElementById('sendMsg').style.color = "red";
		}
		else{
			$.ajax({
				url: '/asklepios/findEmail',
				type: 'post',
				data: {user_id: user_id},
				success:function(data){
					console.log(data)
					if (data === user_email){
						document.getElementById('sendMsg').innerText = "â˜‘ï¸ ì¸ì¦ë²ˆí˜¸ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.";
						document.getElementById('sendMsg').style.color = "#3B82F6";
						cnt ++;
						$.ajax({
							url: '/asklepios/mailSend',
							type: 'post',
							data: {user_email: user_email},
							success:function(data){
								send_email_code = data;
								console.log(data);
							},
							error: function (){
							}
						});
					}else{
						document.getElementById('sendMsg').innerText = "ğŸš« ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
						document.getElementById('sendMsg').style.color = "red";
						document.getElementById('timer').innerText = "";
						cnt = 0;
					}
					if(cnt >0){
						let timer = null;
						let isRunning = false;

						$(function(){
							var display = $('#timer');
							var leftSec = 600;
							// ë‚¨ì€ ì‹œê°„
							// ì´ë¯¸ íƒ€ì´ë¨¸ê°€ ì‘ë™ì¤‘ì´ë©´ ì¤‘ì§€
							if (isRunning){
								clearInterval(timer);
								display.html("");
								startTimer(leftSec, display);
							}else{
								startTimer(leftSec, display);

							}
						});
					}
				},
				error: function (){
					alert("ì™œ ì•ˆë ê¹Œ?");
				}
			});
		}
	}

	// ì´ë©”ì¼ì¸ì¦ìœ¼ë¡œ ì½”ë“œë¥¼ ë°›ìœ¼ë©´ ê·¸ ì½”ë“œë‘ ì…ë ¥í•œ ì½”ë“œê°€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ê¸°ëŠ¥_20241126ìˆ˜í–‰
	function check(){
		let user_email_code = document.getElementById("email_code").value;

		if(user_email_code=== send_email_code){
			document.getElementById('errorMsg').innerText = "â˜‘ï¸ ì¸ì¦ë˜ì—ˆìŠµë‹ˆë‹¤.";
			document.getElementById('errorMsg').style.color = "#3B82F6";
		}else{
			document.getElementById('errorMsg').innerText = "ğŸš« ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
			document.getElementById('errorMsg').style.color = "red";
		}
	}

	function validateForm(){
		let user_email_code = document.getElementById("email_code").value;
		if(user_email_code === send_email_code){
			return true;
		}else{
			Swal.fire({
				icon: 'warning',
				title: 'ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ë°œê¸‰ ì‹¤íŒ¨',
				text: 'ì¡°ê±´ì„ ì¶©ì¡±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.',
				confirmButtonColor: '#3B82F6',
				confirmButtonText: 'í™•ì¸'
			});
			return false;
		}
	}

	// if (data === user_email){
	// 	document.getElementById('sendMsg').innerText = "â˜‘ï¸ ì¸ì¦ë²ˆí˜¸ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.";
	// 	document.getElementById('sendMsg').style.color = "#3B82F6";
	// 	cnt ++;
	// }else{
	// 	document.getElementById('sendMsg').innerText = "ğŸš« ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
	// 	document.getElementById('sendMsg').style.color = "red";
	// 	document.getElementById('timer').innerText = "";
	// 	cnt = 0;
	// }

	function startTimer(count, display) {
		var minutes, seconds;
		timer = setInterval(function () {
			minutes = parseInt(count / 60, 10);
			seconds = parseInt(count % 60, 10);

			minutes = minutes < 10 ? "0" + minutes : minutes;
			seconds = seconds < 10 ? "0" + seconds : seconds;

			display.html(minutes + ":" + seconds);

			// íƒ€ì´ë¨¸ ë
			if (--count < 0) {
				clearInterval(timer);
				alert("ì‹œê°„ì´ˆê³¼");
				display.html("ì‹œê°„ì´ˆê³¼");
				$("button").attr("disabled", true);
				isRunning = false;
			}
		}, 1000);
		isRunning = true;
	}

</script>
</html>
<!--
asklepios - auvn eybb futa dind
https://velog.io/@yujinaa/spring-%ED%8C%80%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%9B%B9%EC%82%AC%EC%9D%B4%ED%8A%B8-%EC%A0%9C%EC%9E%91-10.-%EA%B4%80%EB%A6%AC%EC%9E%90-%ED%8E%98%EC%9D%B4%EC%A7%80 
https://velog.io/@wlsgur1533/%EC%9D%B4%EB%A9%94%EC%9D%BC-%EC%9D%B8%EC%A6%9D%ED%95%98%EA%B8%B0
https://velog.io/@kjh950330/%ED%9A%8C%EC%9B%90-%EC%9E%84%EC%8B%9C-%EB%B9%84%EB%B0%80%EB%B2%88%ED%98%B8-%EC%A0%84%EC%86%A1-%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84
https://velog.io/@nick6253/%EC%9E%84%EC%8B%9C-%EB%B9%84%EB%B0%80%EB%B2%88%ED%98%B8-%EB%B0%9C%EA%B8%89-%EA%B5%AC%ED%98%84SMTP
https://chaereemee.tistory.com/9
https://xetown.com/tips/1023190 (í˜•ì‹)
https://badstorage.tistory.com/59
-->